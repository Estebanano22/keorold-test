<!-- Header -->
<%- include('layautsDashboard/header') %>

<body class="main-body leftmenu body-ingreso">

    <%- include('layautsDashboard/loader') %>

		<!-- Page -->
		<div class="page">

			<!-- Menu -->
			<%- include('layautsDashboard/menu') %> 

			<!-- Cabecera -->
			<%- include('layautsDashboard/head') %> 

			<!-- Main Content-->
			<div class="main-content side-content pt-0">

				<div class="container-fluid">
					<div class="inner-body">

						<!-- Page Header -->
						<div class="page-header">
							<div>
								<h2 class="main-content-title tx-24 mg-b-5"><%- titulo %></h2>
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a href="/dashboard/inicio">Inicio</a></li>
									<li class="breadcrumb-item active" aria-current="page"><%- breadcrumb %></li>
								</ol>
							</div>
						</div>
						<!-- End Page Header -->

						<!-- =============================
							Inicio Componentes Pagina
						============================== -->

						<!-- Row -->
						<div class="row row-sm">
							<div class="col-lg-12">
								<div class="card custom-card">
									<div class="card-body">
										<div>
											<h6 class="main-content-label mb-1">Total Cargas en plataforma</h6>
											<p class="text-muted card-sub-title">A continuación encontrara un reporte detallado de todas cargas de saldo realizadas en su red.</p>
										</div>
										<div class="table-responsive">
											<table class="table table-bordered text-nowrap w-100 key-buttons" id="exportexample">
												<thead>
													<tr>
                                                        <th>Usuario cargado</th>
                                                        <th>Valor carga</th>
                                                        <th>Saldo anterior</th>
														<th>Nuevo saldo</th>
                                                        <th>Tipo de carga</th>
                                                        <th>Acción realizada</th>
                                                        <th>Fecha de carga</th>
													</tr>
												</thead>
												<tbody>
                                                    <% moment.locale('es'); %>
													<% if(cargas.length) { %> 
														<% cargas.forEach(listaCargas => { %>
                                                            <% if(listaCargas.usuario.pais === 'Colombia') { %>
																<% var valorFormateado = new Intl.NumberFormat("es-CO", {style: "currency", currency: "COP", maximumSignificantDigits: 3}).format(listaCargas.valor); %>
                                                                <% var saldoAnteriorFormateado = new Intl.NumberFormat("es-CO", {style: "currency", currency: "COP", maximumSignificantDigits: 3}).format(listaCargas.saldoAnterior); %>
                                                                <% var saldoNuevoFormateado = new Intl.NumberFormat("es-CO", {style: "currency", currency: "COP", maximumSignificantDigits: 3}).format(listaCargas.saldoNuevo); %>
															<% } else { %>
																<% var valorFormateado = new Intl.NumberFormat("en-US", {style: "currency", currency: "USD"}).format(listaCargas.valor); %>
                                                                <% var saldoAnteriorFormateado = new Intl.NumberFormat("en-US", {style: "currency", currency: "COP", maximumSignificantDigits: 3}).format(listaCargas.saldoAnterior); %>
                                                                <% var saldoNuevoFormateado = new Intl.NumberFormat("en-US", {style: "currency", currency: "COP", maximumSignificantDigits: 3}).format(listaCargas.saldoNuevo); %>
															<% } %>
															<tr>
                                                                <td class="text-capitalize"><%= listaCargas.usuario.nombre %></td>
                                                                <td class="text-right"><%= valorFormateado %></td>
                                                                <td class="text-right"><%= saldoAnteriorFormateado %></td>
                                                                <td class="text-right"><%= saldoNuevoFormateado %></td>
                                                                <td class="text-capitalize"><%= listaCargas.tipoCarga %></td>
                                                                <td class="text-capitalize"><%= listaCargas.accionCarga %></td>
                                                                <td class="text-center <%= listaCargas.fechaCarga === null ? 'text-warning' : '' %>"><%= listaCargas.fechaCarga === null ? 'Sin fecha de carga' : moment(listaCargas.fechaCarga).format('MMMM Do YYYY, h:mm:ss a') %></td>
															</tr>
														<% }) %> 
													<% } %> 
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- End Row -->

						<!-- =============================
							Fin Componentes Pagina
						============================== -->

					</div>
				</div>
			</div>
			<!-- End Main Content-->

			<!-- Foot -->
			<%- include('layautsDashboard/foot') %> 

			<!-- Notificiaciones -->
			<%- include('layautsDashboard/notificaciones') %>

		</div>
		<!-- End Page -->

<!-- Modal Comprobante -->
<div class="modal" id="modalComprobante">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content modal-content-demo">
            <div class="modal-header">
                <h6 class="modal-title">Ver comprobante</h6><button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <img src="" alt="Comprobante" id="imgComprobante">
            </div>
            <div class="modal-footer">
                <button class="btn ripple btn-secondary" data-dismiss="modal" type="button">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<%- include('layautsDashboard/footer') %> 


<!-- Scripts Personalizados -->

<% if(locals.mensajes) { %>
	<% const validacionErrores = Object.keys(locals.mensajes) %>
	<% if(validacionErrores.length) { %>
		
		<% locals.mensajes[validacionErrores].forEach(alerta => { %>

			<% if(validacionErrores == 'error') { %>
				<% title = 'Lo Sentimos!' %> 
			<% } else if (validacionErrores == 'success') { %>
				<% title = 'Perfecto!' %> 
			<% } %> 

			<script>
				swal(
					{
						title: "<%= title %>",
						text: "<%= alerta %>",
						type: "<%= validacionErrores %>",
						confirmButtonColor: '#57a94f'
					}
				)
			</script>

		<% }); %>

	<% } %> 
<% } %>

<script>

    function modalComprobante (e, img) {

        const imgComprobante = document.getElementById('imgComprobante');
        imgComprobante.src = '/uploads/comrpobantesJuegos/'+img;

    }ç

</script>